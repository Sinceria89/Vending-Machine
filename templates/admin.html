<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Title</title>
    <script src="https://unpkg.com/@erwinstone/input-touchspin@1.0.3/dist/input-touchspin.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script src="{{url_for('static', filename='/script/main.js')}}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/brands.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/solid.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    

    <style>
        body {
            font-family: "Lato", sans-serif;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .clock {
            font-family: system-ui;
            color: rgb(255, 255, 255);
            font-size: 16px;
            text-align: center;
            padding-right: 5px;
        }

        td {
            height: 70px;
        }

        .navbar {
            background-color: #065488;
        }

        .nav-item {
            border-right: 1px solid #84B6D0;
        }

        .nav-link {
            color: #FFFFFF;
        }
        .baht-sign::before {
         content: "\0E3F";
         font-family: "Arial";
        }
    </style>
</head>

<body>
    <nav class="navbar fixed-top navbar-expand-lg ">
        <div class="container-fluid">
          <a class="navbar-brand" href="#">Icon</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo02"
            aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link text-white active" aria-current="page" href="/homepage">Home</a>
              </li>
              <li class="nav-item">
                {% if 'Shoppingcart' in session %}
                <a class="nav-link" data-bs-toggle="modal" data-bs-target="#Cart"> Shopping Cart: ({{
                  session['Shoppingcart']|length }})</a>
                {% else %}
                <a class="nav-link" data-bs-toggle="modal" data-bs-target="#Cart"> Shopping Cart: (0)</a>
                {% endif %}
              </li>
              <li class="nav-item">
              <a class="nav-link text-white active" aria-current="page" href="/products_manage">Manage Product</a>
            </li>
            </ul>
            <div class="clock flex-nowrap" id="clock" onload="clock"></div>
            <ul class="navbar-nav">
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDarkDropdownMenuLink" role="button"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  ยินดีต้อนรับคุณ {{ user['first_name'] }}
                </a>
                <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="navbarDarkDropdownMenuLink">
                  <li><a class="dropdown-item" href="#">ข้อมูลผู้ใช้</a></li>
                  {% if 'admin' in session %}
                  <li><a class="dropdown-item" href="/admin">จัดการระบบ (Admin)</a></li>
                  {% endif %}
                  <li><a class="dropdown-item" href="/logout">ออกจากระบบ</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    <div class="modal fade" id="Cart">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title">Shopping Cart</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-sm">
                        {% set max_value = 3%}
                        {% if 'Shoppingcart' in session %}
                        <thead>
                            <th></th>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Total</th>
                            <th>Update</th>
                            <th>Delete</th>
                        </thead>
                        <tbody>
                            {% for Cart_list in session['Shoppingcart'] %}
                            <tr>
                                <td>{{loop.index}}</td>
                                <td><img src="/static/upload/{{ Cart_list.image }}" class="display"
                                        alt="{{Cart_list.product_name}}">
                                </td>
                                <input type="hidden" name="cart_item_id" value="{{ Cart_list.cart_item_id }}" />
                                <input type="hidden" name="product_id" value="{{ Cart_list.product_id }}" />
                                <td>{{Cart_list.product_name}}</td>
                                <form action="{{url_for('update_cart_item', cart_item_id=Cart_list.cart_item_id)}}"
                                    method="POST">
                                    <td>${{"%.2f"|format(Cart_list.price)}}</td>
                                    <input type="hidden" name="cart_item_id" value="{{ Cart_list.cart_item_id }}" />
                                    {% for product in products %}
                                    {% if product.stock < max_value %} {% set max_value=product.stock%} {% endif %}{%
                                        endfor %} <td>
                                        <input type="number" name="cart_quantity" min="1" max="{{ max_value }}"
                                            value="{{ Cart_list.quantity|default('1') }}">
                                        </td>

                                        {% set Subtotal = Cart_list.quantity | int * Cart_list.price| int%}
                                        <td>{{ Subtotal }}</td>
                                        <td><button type="submit" class="btn btn-sm btn-info">Update</button> </td>
                                </form>
                                <td><a href="{{ url_for('delete_cart_item', cart_item_id=Cart_list.cart_item_id) }}"
                                        class="btn btn-danger btn-sm">Remove</a></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        {% else: %}
                        <div>
                            <h3>Your Cart is Empty</h3>
                        </div>
                        {% endif %}
                    </table>
                    <table class="table table-sm">
                        {% if 'Shoppingcart' in session %}
                        <tr>
                            <td> <a href="{{url_for('transaction')}}" class="btn btn-success"> Order now </a> </td>
                            <td width="35%"></td>
                            <td>
                                <h5>Total Quantity: {{ session['Shoppingcart'][0]['total_quantity'] }}</h5>
                            </td>
                            <td>
                                <h5>Total Price: ฿{{ session['Shoppingcart'][0]['total_price'] }}</h5>
                            </td>
                            <td> <a href="{{url_for('empty_cart')}}" class="btn btn-danger  float-right "> Clear
                                    cart</a>
                            <td></td>
                        </tr>
                        {% else: %}
                        {% endif %}
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-bs-dismiss="modal">
                        <span class="glyphicon glyphicon-shopping-cart"></span> Continue Shopping
                    </button></td>
                </div>
            </div>
        </div>
    </div>
  
    <div class="container-fluid">

        <!-- Page Heading -->
        <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="text-black-800">Dashboard</h1>
        </div>

        <!-- Content Row -->
        <div class="row">

            <!-- Income-DASHBOARD-->
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    Income</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">{{ combined_total_price }}</div>
                            </div>
                            <div class="col-auto">
                                <i class="baht-sign fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            

        <!-- Content Row -->

        <div class="row">

            <!-- Area Chart -->
            <div class="col-xl-8 col-lg-7">
                <div class="card shadow mb-4">
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">Product Stock</h6>  
                    </div>
                    <!-- Card Body -->
                    <div class="card-body">
                        <div class="chart-area">
                            <img src="{{ url_for('static', filename='barchart.png') }}" alt="Product Stock Chart">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pie Chart -->
            <div class="col-xl-4 col-lg-5">
                <div class="card shadow mb-4">
                    <!-- Card Header - Dropdown -->
                    <div
                        class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">Top 3 Best Seller</h6>
                    </div>
                    <!-- Card Body -->
                    <div class="card-body">
                        <div class="chart-pie pt-4 pb-2">
                            <img src="{{ url_for('static', filename='chart.png') }}" alt="Top3Seller">
                        </div>
                    </div>
                </div>
            </div>
        </div>

    
</body>

</html>