<!DOCTYPE html>
<html>
<head>

  <title>Product List</title>
</head>
<body>
    <title>Product Stock Levels</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@observablehq/runtime@4.4.1/dist/runtime.js"></script>

    <div class="float-right">
        <a href="/products_manage" class="btn btn-primary">Product management</a>
        <a href="/logout" class="btn btn-danger">logout</a>
    </div>
</h2>
</div>
  <h1>Product List</h1>
  <table>
    <thead>
      <tr>
        <th>Product Name</th>
        <th>Stock Quantity</th>
      </tr>
    </thead>
    <tbody>
      {% for product in products %}
        <tr>
          <td>{{ product.product_name }}</td>
          <td>{{ product.stock }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div id="chart"></div>

  <script>
    document.addEventListener("DOMContentLoaded", function(event) {
      // Extract product names and stock quantities from the rendered HTML
      var productNames = Array.from(document.querySelectorAll("tbody td:nth-child(1)")).map(function(el) {
        return el.textContent;
      });

      var stockQuantities = Array.from(document.querySelectorAll("tbody td:nth-child(2)")).map(function(el) {
        return parseInt(el.textContent);
      });

      // Create a bar chart using Plotly
      var trace = {
        x: productNames,
        y: stockQuantities,
        type: 'bar'
      };

      var layout = {
        title: 'Product Stock Levels',
        xaxis: {
          title: 'Product Name'
        },
        yaxis: {
          title: 'Stock Quantity'
        }
      };

      var data = [trace];

      Plotly.newPlot('chart', data, layout);
    });
  </script>
</body>
</html>

