<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://fonts.googleapis.com/css2?family=Sriracha&display=swap&subset=thai" rel="stylesheet">

  <title>กล่องจ่ายยาอัตโนมัติ</title>
  <script src="https://unpkg.com/@erwinstone/input-touchspin@1.0.3/dist/input-touchspin.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome.css') }}" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/brands.css') }}" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/solid.css') }}" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    .myDiv {
      height: 55px;
      background-color: #e7a7d9;
      text-align: center;
    }

    /* Make the container wider */
    .container {
      max-width: 800px;

    }

    .clock {
      font-family: system-ui;
      color: white;
      font-size: 16px;
      text-align: left;
    }

    p {
      font-family: 'Sriracha', cursive;
      font-size: 32px;
      color: #e7a7d9;
    }

    .led-sign {
      display: flex;
      justify-content: right;
      align-items: right;
      height: 30px;
      width: 300px;
      overflow: hidden;
    }

    .led-sign ul {
      display: flex;
      list-style-type: none;
      margin: 0;
      padding: 0;
      animation: led 10s linear infinite;
    }

    .led-sign ul li {
      color: #fff;
      font-size: 20px;
      font-weight: bold;
      margin-right: 5px;
    }


    @keyframes led {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-200%);
      }
    }
  </style>

</head>

<body style="background-color: #4b4b4b;">
  <div class="myDiv">
    <div class="container">
      <div class="row">
        <div class="col-12 col-sm-4">
          <a href="/login">
            <img src="../static/logo.png" alt="logo" style="height: 55px;">
          </a>
        </div>
        <div class="clock col-12 col-sm-3" id="clock" onload="clock"></div>
        <div class="led-sign col-12 col-sm-5 text-container text-right">
          <ul>
            <li>เข้าสู่ระบบแอดมิน</li>
          </ul>
        </div>
      </div>
    </div>
  </div>




  <div class="container">
    <h1 style="margin-bottom: 10px"> Shopping Cart: ({{ session['Shoppingcart']|length }})</h1>

    <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#Cart" style="margin-bottom: 10px">
      Your items
    </button>

    <div class="modal fade" id="Cart">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title">Shopping Cart</h1>
            <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <table class="table table-sm">
              {% set max_value = 3%}
              {% if 'Shoppingcart' in session %}
              <thead>
                <th></th>
                <th>Image</th>
                <th>Name</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th>Update</th>
                <th>Delete</th>
              </thead>
              <tbody>

                {% for key, product in session['Shoppingcart'].items() %}
                <tr>
                  <td>{{loop.index}}</td>
                  <td><img src="/static/upload/{{ product.image }}" alt="{{product.name}}"></td>
                  <td>{{product.product_name}}</td>
                  <form action="{{url_for('updatecart', code=key)}}" method="post">
                    <td>${{"%.2f"|format(product.price)}}</td>
                    {% if product.stock < max_value %} {% set max_value=product.stock%} {% endif %} <td> <input
                        type="number" name="cart_quantity" min="1" max="{{ max_value }}" value="{{product.quantity}}">
                      </td>

                      {% set Subtotal = product.quantity | int * product.price| int%}
                      <td>{{ Subtotal }}</td>
                      <td><button type="submit" class="btn btn-sm btn-info">Update</button> </td>
                  </form>
                  <td> <a href="{{url_for('deleteitem', product_id=key)}}" class="btn btn-sm btn-danger">Delete</a></td>
                </tr>
                {% endfor %}
                {% else: %}
                <div>
                  <h3>Your Cart is Empty</h3>
                </div>
                {% endif %}
              </tbody>
            </table>
            <table class="table table-sm">
              {% if 'Shoppingcart' in session %}
              <tr>
                <td> <a href="http://127.0.0.1:3000" class="btn btn-success"> Order now </a> </td>
                <td width="35%"></td>
                <td>
                  <h5>Total Quantity: {{TotalQuantity}}</h5>
                </td>
                <td>
                  <h5>Total Price: ฿{{grandtotal}} </h3>
                </td>
                <td> <a href="{{url_for('empty_cart')}}" class="btn btn-danger btn-sm float-right mr-4"> Clear
                    cart</a>
                </td>
                {% else: %}
                {% endif %}
              </tr>
            </table>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              <span class="glyphicon glyphicon-shopping-cart"></span> Continue Shopping
            </button></td>
          </div>
        </div>
      </div>
    </div>

    <div class="container" style="margin-top: 10px">
      <div class="section-header">
        <h2><i class="fa-solid fa-book fa-2xl"></i> Our Product </h2>
        <p>และนี่คือสินค้าของพวกเรา</p>
      </div>



      <div class="row" style="margin-top: 20px">
        {% for product in products %}
        {% if product.stock < max_value %} {% set max_value=product.stock%} {% endif %} {% if product.stock> 0 %}
          <div class="col-xs-6 col-sm-4">
            <form method="post" action="{{url_for('AddCart')}}">
              <div class="single-publication">
                <figure class="display">
                  <img src="/static/upload/{{ product.image }}" class="image">
                </figure>

                <div class="publication-content">
                  <span class="category">{{ product.product_category }}</span>
                  <h3>{{ product.product_name }}</h3>
                  <h4 class="price">฿ {{ product.price }}</h4>
                </div>

                <div class="add-to-cart">
                  <input type="hidden" name="product_id" value="{{ product.product_id }}" />
                  <div class="touchspin d-flex align-items-center gap-2">
                    <button type="button" class="btn btn-danger" data-touchspin-down>-</button>
                    <input type="number" class="form-control text-center" name="quantity" value="1" min="1"
                      max="{{ max_value }}" data-touchspin-input />
                    <button type="button" class="btn btn-success" data-touchspin-up>+</button>
                  </div>

                  <div class="button-def">
                    <button type="button" class="btn btn-primary" data-toggle="modal"
                      data-target="#detailsModal{{ product.product_id }}">
                      Detail
                    </button>

                    <input type="submit" value="Add to Cart" class="btn btn-warning" />
                  </div>
                </div>
              </div>
            </form>
          </div>



          <div class="modal fade" id="detailsModal{{ product.product_id }}">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h2 class="modal-title text-primary" style="align-content: center;">{{ product.product_name }}'s
                    Detail</h2>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body" style="align-content: center; text-align: center;">
                  <img src="/static/upload/{{ product.image }}" class="image">
                  <p>Description: {{ product.description }}</p>
                  <p>Price: ฿ {{ product.price }}</p>
                  <p>In-Stock: {{ product.stock }}</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal" aria-label="Close">Close</button>
                </div>
              </div>
            </div>
          </div>
          {% endif %}
          {% endfor %}
      </div>
    </div>
  </div>


</body>


<script>
  function updateClock() {
    let now = new Date();
    let day = now.toLocaleDateString('en-GB', { day: '2-digit' });
    let month = now.toLocaleDateString('en-GB', { month: '2-digit' });
    let year = now.toLocaleDateString('en-GB', { year: 'numeric' });
    let dayOfWeek = now.toLocaleDateString('th-TH', { weekday: 'long' });
    let time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
    document.getElementById('clock').innerHTML = dayOfWeek.toUpperCase() + '|' + time + '<br>' + day + '-' + month + '-' + year;
  }

  updateClock();
  setInterval(updateClock, 1000);
</script>
<!--
<script src="{{url_for('static', filename='script/main.js')}}"></script>
//-->